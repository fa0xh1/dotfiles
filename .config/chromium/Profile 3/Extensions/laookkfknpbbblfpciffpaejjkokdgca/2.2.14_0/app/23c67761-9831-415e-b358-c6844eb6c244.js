var fn_addin=function(l,c,t){var o=o||{};return o.styles=o.styles||{},o.commands=o.commands||{},o.dependencies=t||o.dependencies||{},o.styles.style=function(){},o.views=o.views||{},o.collect=o.collect||{},o.models=o.models||{},o.templates=o.templates||{},o.info={widget:!0,id:"notes","data-test":"notes",label:"Notes",placeholderType:"pane",region:"bottom-right",order:"prepend",storedHeight:"notes-pane-height",width:750,height:520,addin:"23c67761-9831-415e-b358-c6844eb6c244",requiredFeature:["notes","notes-degraded"],toggleEvent:"globalEvent:key:N",hideEvents:["globalEvent:toggle:bottom-left","globalEvent:toggle:bottom-right","globalEvent:toggle:top-right"],visibleSetting:"notesVisible"},l.console.log(l.elapsed()+": "+o.info.id+" started"),o.templates=o.templates||{},o.templates.detail=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){var n;return'<div class="list-bar-wrapper">\n\t<div class="list-bar"></div>\n</div>\n\n<div class="detail-bar">\n\t<div class="header notes-detail-header">\n\t\t<span class="notes-detail-title"></span>\n\n\t\t<div class="controls main-nav">\n\t\t\t<span class="control new" title="New Note" data-test="new-note">\n\t\t\t\t<span class="icon-wrapper">\n\t\t\t\t\t<svg class="icon icon-plus" viewBox="0 0 448 448" xmlns="http://www.w3.org/2000/svg"><path d="m408 184h-136c-4.417969 0-8-3.582031-8-8v-136c0-22.089844-17.910156-40-40-40s-40 17.910156-40 40v136c0 4.417969-3.582031 8-8 8h-136c-22.089844 0-40 17.910156-40 40s17.910156 40 40 40h136c4.417969 0 8 3.582031 8 8v136c0 22.089844 17.910156 40 40 40s40-17.910156 40-40v-136c0-4.417969 3.582031-8 8-8h136c22.089844 0 40-17.910156 40-40s-17.910156-40-40-40zm0 0"/></svg>\n\t\t\t\t</span>\n\t\t\t</span>\x3c!--\n\t\t\t--\x3e<span class="control delete" title="Delete" data-test="delete-note">\n\t\t\t\t<span class="icon-wrapper">\n\t\t\t\t\t<svg class="icon icon-trash" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 24"><path d="M19.15 7.5H2.838a.5.5 0 0 0-.5.5l1.81 14a2 2 0 0 0 2 2h9.954a2 2 0 0 0 2-2L19.65 8a.5.5 0 0 0-.5-.5zm-9.9 13a.75.75 0 0 1-1.5 0v-9a.75.75 0 0 1 1.5 0v9zm5 0a.75.75 0 0 1-1.5 0v-9a.75.75 0 0 1 1.5 0v9zM20.43 4h-4.18a.25.25 0 0 1-.25-.25V2.5A2.5 2.5 0 0 0 13.5 0h-5A2.5 2.5 0 0 0 6 2.5v1.25a.25.25 0 0 1-.25.25h-4.5a1 1 0 0 0 0 2h19.18a1 1 0 0 0 0-2zM8 3.75V2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v1.25a.25.25 0 0 1-.25.25h-5.5A.25.25 0 0 1 8 3.75z" fill-rule="nonzero"/></svg>\n\t\t\t\t</span>\n\t\t\t</span>\x3c!--\n\t\t\t--\x3e<span class="control restore" title="Restore" data-test="restore-note">\n\t\t\t\t<span class="icon-wrapper">\n\t\t\t\t\t<svg class="icon icon-undelete" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 24"><path d="M18.592 9H3.279a.5.5 0 0 0-.5.5L3.904 22a2 2 0 0 0 2 2H16.05a2 2 0 0 0 2-2l1.043-12.5a.5.5 0 0 0-.5-.5zm-12.41 3.512c0-.346.324-.509.656-.509s.645.163.645.51l.038 1.797c.998-1.735 2.405-2.504 4.691-2.006 2.287.5 3.258 2.6 3.134 4.622-.123 2.021-1.692 3.725-3.599 4.078-1.906.353-4.048-.663-4.826-2.518-.131-.317.298-.821.6-.96.302-.14.622.052.854.307.805.887 1.28 1.43 2.617 1.43s2.27-.73 2.49-1.904c.22-1.173 0-2.36-1.002-3.171-1.001-.811-2.754-.637-3.57.499l.794.042c.331 0 .521.378.521.725 0 .346-.112.807-.443.807H7.019c-.159 0-.613.052-.725-.066-.113-.118-.112-.714-.112-.88v-2.803zm8.783-9.06a.25.25 0 0 1-.293-.198l-.238-1.229A2.5 2.5 0 0 0 11.505.049L6.6 1a2.5 2.5 0 0 0-1.98 2.929l.237 1.228a.248.248 0 0 1-.196.292l-3.822.757a1 1 0 0 0-.794 1.17c.119.534.633.88 1.172.794l18.516-3.66a1 1 0 0 0-.38-1.964l-4.388.906zm-8.385.1a.5.5 0 0 1 .397-.585l4.912-.95a.5.5 0 0 1 .585.398l.238 1.23a.25.25 0 0 1-.2.293L7.11 4.973a.25.25 0 0 1-.293-.198L6.58 3.552z" fill-rule="nonzero"/></svg>\n\t\t\t\t</span>\n\t\t\t</span>\x3c!--\n\t\t--\x3e<span class="control toggle-fullscreen" title="Toggle Fullscreen" data-test="notes-toggle-fullscreen">\n\t\t\t\t<span class="icon-wrapper ">\n\t\t\t\t\t<svg class="icon icon-expand" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"/></svg>\n\t\t\t\t\t<svg class="icon icon-restore" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 451.37"><path d="M443.31,81.31,350.63,174l32.92,31c15.12,15.12,4.41,41-17,41h-112a24,24,0,0,1-24-24V110c0-21.38,25.8-32.09,40.92-17l31.08,33,92.68-92.69a16,16,0,0,1,22.63,0l25.37,25.38A16,16,0,0,1,443.31,81.31Z" transform="translate(0 -28.63)"></path><path d="M4.69,427.31l92.68-92.68-32.92-31c-15.12-15.12-4.41-41,17-41h112a24,24,0,0,1,24,24v112c0,21.38-25.8,32.09-40.92,17l-31.08-33L52.69,475.31a16,16,0,0,1-22.63,0L4.69,449.94a16,16,0,0,1,0-22.63Z" transform="translate(0 -28.63)"/></svg>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</div>\n\n\t\t<span class="controls delete-nav delete-group">\n\t\t\t<span class="delete-msg">Delete?</span>\x3c!--\n\t\t\t--\x3e<span class="delete-loading">Deleting...</span>\x3c!--\n\t\t\t--\x3e<span class="delete-failed" title="Retry">Trouble connecting...</span>\x3c!--\n\t\t\t--\x3e<span class="control delete-yes" data-test="confirm-delete-note">\n\t\t\t\t\t<span class="icon-wrapper">\n\t\t\t\t\t\t<svg class="icon icon-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 577.95 469.42"><polygon points="195.09 469.42 137.44 424.64 140.4 421.42 0 298 46.22 245.43 187.68 369.79 526.33 0 577.95 47.28 229.72 427.53 195.09 469.42"/></svg>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\x3c!--\n\t\t\t--\x3e<span class="control delete-no">\n\t\t\t\t\t<span class="icon-wrapper">\n\t\t\t\t\t\t<svg class="icon icon-x" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 47.97 47.97"><path d="M28.23,24,47.09,5.12A3,3,0,0,0,42.85.88L24,19.74,5.12.88A3,3,0,0,0,.88,5.12L19.74,24,.88,42.85a3,3,0,1,0,4.24,4.24L24,28.23,42.85,47.09a3,3,0,0,0,4.24-4.24Z" transform="translate(0 0)"/></svg>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t</span>\n\t</div>\n\n\t<div class="note-body">\n\t\t<div class="message">\n\t\t\tRestore this note to edit.\n\t\t\t<span class="button restore-note">Restore</span>\n\t\t</div>\n\t\t<textarea\n\t\t\tcontenteditable="true"\n\t\t\tclass="notes-input notes-textarea"\n\t\t\tplaceholder="New Note…"\n\t\t\tdata-test="notes-textarea"\n\t\t>'+this.escapeExpression("function"==typeof(n=null!=(n=e.body||(null!=t?t.body:t))?n:e.helperMissing)?n.call(t,{name:"body",hash:{},data:s}):n)+"</textarea>\n\t</div>\n</div>\n"},useData:!0}),o.templates.item=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){var n,o=e.helperMissing,l="function",a=this.escapeExpression;return'<div>\n\t<span class="notes-list-title" data-test="note-list-title">'+a(typeof(n=null!=(n=e.title||(null!=t?t.title:t))?n:o)==l?n.call(t,{name:"title",hash:{},data:s}):n)+'</span>\n</div>\n<div class="notes-list-row-description">\n\t<span class="notes-list-date">'+a(typeof(n=null!=(n=e.updatedDate||(null!=t?t.updatedDate:t))?n:o)==l?n.call(t,{name:"updatedDate",hash:{},data:s}):n)+'</span><span class="notes-list-body" data-test="note-list-body">'+a(typeof(n=null!=(n=e.body||(null!=t?t.body:t))?n:o)==l?n.call(t,{name:"body",hash:{},data:s}):n)+"</span>\n</div>\n"},useData:!0}),o.templates.list=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){var n,o;return'<div class="notes-list">\n\t<div class="note-list-outer-wrapper">\n\t\t<div class="subviews-wrapper">\n\t\t\t<div class="subviews">\x3c!--\n\t\t\t\t--\x3e<div class="note-list-wrapper subview">\n\t\t\t\t\t<header class="header notes-list-header">\n\t\t\t\t\t\t<div class="search-more-wrapper">\n\t\t\t\t\t\t\t<span class="search-wrapper">\n\t\t\t\t\t\t\t\t<span class="input-wrapper">\n\t\t\t\t\t\t\t\t\t<i class="icon icon-search"></i>\n\t\t\t\t\t\t\t\t\t<span class="icon-clear-wrapper">\n\t\t\t\t\t\t\t\t\t\t<svg class="icon icon-clear" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212.982 212.982"><path d="M131.804 106.491l75.936-75.936c6.99-6.99 6.99-18.323 0-25.312-6.99-6.99-18.322-6.99-25.312 0L106.491 81.18 30.554 5.242c-6.99-6.99-18.322-6.99-25.312 0-6.989 6.99-6.989 18.323 0 25.312l75.937 75.936-75.937 75.937c-6.989 6.99-6.989 18.323 0 25.312 6.99 6.99 18.322 6.99 25.312 0l75.937-75.937 75.937 75.937c6.989 6.99 18.322 6.99 25.312 0 6.99-6.99 6.99-18.322 0-25.312l-75.936-75.936z"/></svg>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<input type="text" name="search" id="notes-search" class="search-input notes-search" placeholder="Search">\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<div class="more">\n\t\t\t\t\t\t\t\t<div class="icon-wrapper more-toggle">\n\t\t\t\t\t\t\t\t\t'+(null!=(n="function"==typeof(o=null!=(o=e.iconEllipsis||(null!=t?t.iconEllipsis:t))?o:e.helperMissing)?o.call(t,{name:"iconEllipsis",hash:{},data:s}):o)?n:"")+'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="dropdown more-dropdown">\n\t\t\t\t\t\t\t\t\t<ul class="dropdown-list">\n\t\t\t\t\t\t\t\t\t\t<li class="show-deleted">\n\t\t\t\t\t\t\t\t\t\t\t<span class="dropdown-list-icon-wrapper">\n\t\t\t\t\t\t\t\t\t\t\t\t<svg class="dropdown-list-icon icon icon-trash" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 24"><path d="M19.15 7.5H2.838a.5.5 0 0 0-.5.5l1.81 14a2 2 0 0 0 2 2h9.954a2 2 0 0 0 2-2L19.65 8a.5.5 0 0 0-.5-.5zm-9.9 13a.75.75 0 0 1-1.5 0v-9a.75.75 0 0 1 1.5 0v9zm5 0a.75.75 0 0 1-1.5 0v-9a.75.75 0 0 1 1.5 0v9zM20.43 4h-4.18a.25.25 0 0 1-.25-.25V2.5A2.5 2.5 0 0 0 13.5 0h-5A2.5 2.5 0 0 0 6 2.5v1.25a.25.25 0 0 1-.25.25h-4.5a1 1 0 0 0 0 2h19.18a1 1 0 0 0 0-2zM8 3.75V2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v1.25a.25.25 0 0 1-.25.25h-5.5A.25.25 0 0 1 8 3.75z" fill-rule="nonzero"/></svg>\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class="dropdown-list-label">Deleted</span>\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="list-bar-toggle" data-test="notes-toggle-fullscreen-list-view">\n\t\t\t\t\t\t\t<span class="control icon-wrapper toggle-list-icons" title="Note List">\n\t\t\t\t\t\t\t\t<i class="icon icon-list-toggle u--no-transition">\n\t\t\t\t\t\t\t\t\t<span class="list-toggle-top"></span>\n\t\t\t\t\t\t\t\t\t<span class="list-toggle-middle"></span>\n\t\t\t\t\t\t\t\t\t<span class="list-toggle-bottom"></span>\n\t\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</header>\n\t\t\t\t\t<ol class="list note-list"></ol>\n\t\t\t\t</div>\x3c!--\n\n\t\t\t\t--\x3e<div class="subview trash-subview">\n\t\t\t\t\t<header class="header notes-deleted-header">\n\t\t\t\t\t\t<span class="control icon-wrapper back"><i class="icon icon-left"></i></span>\n\t\t\t\t\t\t<span class="title">Deleted</span>\n\t\t\t\t\t\t<span>&nbsp;</span>\n\t\t\t\t\t</header>\n\t\t\t\t\t<span class="deleted-description">Automatically removed<br>after 2 weeks</span>\n\t\t\t\t\t<ol class="list deleted-list"></ol>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="u--pafill notes-empty">\n\t\t<div class="empty">\n\t\t\t<div class="title">Take quick notes and store wisdom to view later.</div>\n\t\t\t<div class="description">No notes yet. Add a note to get started!</div>\n\t\t\t<span class="button notes-empty-new" data-test="new-note-empty">New Note</span>\n\t\t</div>\n\t</div>\n\t<div class="u--pafill notes-deleted-empty">\n\t\t<div class="empty">\n\t\t\t<div class="description">No deleted notes yet</div>\n\t\t\t<span class="button back-to-list">Back To List</span>\n\t\t</div>\n\t</div>\n\t<div class="notes-loading"><i class="loading-icon"></i>Loading…</div>\n</div>\n'},useData:!0}),o.templates.notes=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){return'<div class="list-view" data-test="notes-list-view"></div>\n<div class="detail-view"></div>\n'},useData:!0}),o.styles=o.styles||{},o.styles.style=function(){var t=document.createElement("style");t.type="text/css",t.innerHTML='.notes{--app-height:520px;--app-width:750px;--sidebar-width:200px;--header-height:53px}.notes.fullscreen{--app-height:100vh;--sidebar-width:250px}.notes-app{height:var(--app-height);width:var(--app-width);min-width:450px;max-width:none;padding:0;display:flex;overflow:hidden;transition:transform var(--a-fast) var(--a-curve)}.notes-app .header{height:var(--header-height)}.notes .subviews{--subviews-transition-duration:0.3s;width:calc(var(--sidebar-width) * 4);transition:all var(--subviews-transition-duration) ease}.slomo .subviews{transition:all calc(var(--subviews-transition-duration) * 10) ease}.notes .subviews.no-transition{transition:none}.notes .subview{height:var(--app-height);width:var(--sidebar-width);display:inline-flex;flex-direction:column}.notes .list-view{--app-padding:17px;--list-view-transition-duration:0.1s;transition:opacity var(--list-view-transition-duration) ease}.slomo .list-view{transition:opacity calc(var(--list-view-transition-duration) * 10) ease}.hide-content .list-view{opacity:0}.notes-list{height:100%;width:var(--sidebar-width);display:flex;flex-direction:column;border-right:1px solid var(--border-color)}.notes-list.loading{align-items:center;justify-content:center}.notes-deleted-empty,.notes-list.loading .footer-input,.notes-list.loading .note-list-outer-wrapper,.notes-list.loading .notes-empty{display:none}.notes-loading{display:none;opacity:.7}.notes-list.loading .notes-loading{display:block}.note-list-outer-wrapper{min-height:0;display:flex;flex:1}.note-list-wrapper{flex:1}.note-list-wrapper.subview{transition:none}.notes-list-header{padding-left:6px;padding-right:12px}.notes-list-header .search-more-wrapper{height:100%;display:flex;align-items:center;flex:1 0 auto;opacity:1;visibility:visible}.notes .search-wrapper .icon-clear,.notes-list-header .list-bar-toggle{display:none}.notes .search-wrapper{width:84px;margin-right:8px}.notes-list .search-wrapper .icon-search:before{top:49%}.notes-list-header .more{margin-right:0}.notes-list-header .more-toggle{margin-bottom:3px;padding:0}.notes-list-header .more-dropdown{top:33px;right:-3px}.notes-deleted-header{justify-content:center}.notes .notes-deleted-header .control.icon-wrapper.back{height:auto}.notes-list .deleted-description{margin-top:-11px;padding:0 var(--app-padding) calc(var(--app-padding) - 6px);display:inline-block;opacity:.7;font-size:.75rem;line-height:1.4;text-align:center}.notes-list .list{max-height:calc(var(--app-height) - var(--header-height));overflow-y:auto}.notes-list-item{margin-top:-1px;padding:8px var(--app-padding);position:relative;cursor:pointer;font-size:100%;-webkit-transition:color .05s ease}.notes-list-item:first-child{margin-top:0}.notes-list-item:last-child{margin-bottom:var(--app-padding)}.notes-list-body,.notes-list-title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.notes-list-title{max-width:100%;display:block;font-size:.9375rem;font-weight:500;opacity:.8}.notes-list-item.selected .notes-list-title,.notes-list-item:hover .notes-list-title{opacity:1}.notes-list-row-description{height:19px;display:flex;align-items:flex-end}.notes-list-date{padding-right:6px;flex-shrink:0;font-size:.75rem;opacity:.4}.notes-list-item:hover .notes-list-date{opacity:.6}.notes-list-body{font-size:.8125rem;opacity:.5}.notes-list-item:hover .notes-list-body{opacity:.8}.notes-list-item.list-borders:after,.notes-list-item.list-borders:first-child:before{height:1px;position:absolute;bottom:0;left:var(--app-padding);right:var(--app-padding);background:rgba(255,255,255,.15);content:""}.notes-list-item.list-borders:first-child:before{top:0;bottom:auto}.notes-list-item.list-borders.above-selected:after,.notes-list-item.list-borders.selected:after,.notes-list-item.list-borders.selected:first-child:before{left:0;right:0}.notes-list-item.selected{background:rgba(255,255,255,.1);z-index:10}.light .notes-list-item.list-borders:after,.light .notes-list-item.list-borders:first-child:before,.light .notes-list-item.selected{background:rgba(0,0,0,.06);z-index:10}.notes .footer-input{display:none;flex:0 0 auto}.notes .notes-input{width:100%;background:0 0;border:0;outline-width:0}.notes .notes-new{padding-top:11px;padding-bottom:calc(var(--app-padding) - 2px)}.notes-deleted-empty,.notes-empty{margin-left:var(--sidebar-width)}.notes-empty-loading{display:none}.loading .notes-empty-loading{display:block}.notes-empty-new{cursor:pointer}.notes-empty-description{margin:0;font-size:93.75%;opacity:.575}.notes .loading .description,.notes .loading .title{display:none}.notes .empty{height:100%;display:flex}.notes .deleted-empty .notes-deleted-empty{display:block}.notes-new-loading{height:11px;width:11px;position:absolute;top:13px;right:10px;display:none;border-width:1px}.loading .notes-new-loading{display:inline}.notes-new-error{height:14px;width:14px;position:absolute;top:12px;right:16px;display:none;border-radius:100%;text-align:center;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.failed .notes-new-error{display:inline}.notes .detail-view{--app-padding:25px;--detail-view-transition-duration:0.1s;flex-grow:1;transition:opacity var(--detail-view-transition-duration) ease}.slomo .detail-view{transition:opacity calc(var(--detail-view-transition-duration) * 10) ease}.hide-content .detail-view{opacity:0}.notes-detail{height:100%;flex:1 1 auto;display:flex;align-items:stretch}.notes-detail-header{position:relative;z-index:2;justify-content:center}.notes-detail-title{display:inline-block;opacity:.35;font-size:.8125rem}.light .notes-detail-title{opacity:.4}.notes-detail .header .back{position:absolute;left:0}.notes-detail .header .controls{position:absolute;right:0}.notes-detail .control{padding-top:0;padding-bottom:0;cursor:pointer}.notes-detail .control .icon-wrapper{padding:0 5px}.notes-detail .delete{margin-right:1px}.notes-detail .restore{display:none}.notes-detail.deleted .restore{display:inline-block}.notes-detail.deleted .delete{display:none}.notes-detail .icon-left{height:14px}.notes-detail .new .icon-wrapper{margin-right:-1px;margin-left:-1px}.notes-detail .toggle-fullscreen .icon-wrapper{padding-left:3px}.notes .delete-group{display:none;align-items:center;opacity:.96;font-size:87.5%}.notes-detail .delete-group.show{display:flex}.notes .delete-group .delete-msg{height:auto;margin-right:10px}.notes .delete-group .control.delete{width:25px;margin:0 1px;opacity:1}.notes .delete-group .icon{height:auto}.notes .delete-group .icon-checkmark{width:13px}.notes .delete-group .icon-x{width:11px}.notes-detail .delete-failed,.notes-detail .delete-group.loading .delete,.notes-detail .delete-loading{display:none}.notes-detail .delete-group.loading .delete-loading{display:inline}.notes-detail .delete-group.failed .delete{display:none}.notes-detail .delete-group.failed .delete-failed{display:inline}.notes .delete-group .delete-loading{margin-right:6px}.notes .delete-group .delete-failed{padding:6px;opacity:.8;cursor:pointer}.notes .delete-group .delete-failed:hover{opacity:1}.note-body{flex-grow:1;display:flex;flex-direction:column}.notes-detail .message{display:none;padding:6px 0;text-align:center;font-size:.8125rem}.notes-detail .message.active{display:block}.notes-detail .message .button{margin-left:8px;padding:6px 16px;font-size:.75rem}.notes .notes-textarea{height:auto;padding:var(--app-padding);padding-top:2px;flex-grow:1;opacity:.96;border-bottom:none;cursor:text;font-size:.9375rem;line-height:1.25rem}.notes .list-bar-wrapper{display:none}.notes .header .title{font-size:.9rem}.notes .header .back{position:absolute;left:0}.notes .list-bar{display:flex;flex-direction:column}.notes .note-list-header .toggle-list-icons{--notes-toggle-transition-duration:0.5s;transition:transform var(--notes-toggle-transition-duration) ease}.notes .detail-bar{flex:1 0;display:inline-flex;position:relative;flex-direction:column}.notes .detail-bar.inactive,.notes .icon-restore{display:none}.notes .notes-detail-header .toggle-list-icons{padding-left:12px}.notes.fullscreen .list-bar-wrapper{max-width:0;position:relative;z-index:3;flex:1 1 20%;display:flex;flex-direction:column;border-right:1px solid rgba(255,255,255,0);box-sizing:content-box;transition:all .5s ease}.notes.fullscreen .list-bar-open .list-bar-wrapper{max-width:var(--sidebar-width);border-right:1px solid var(--border-color);transform:translateX(0)}.notes.fullscreen .list-bar{--list-bar-transition-duration:0.5s;width:var(--sidebar-width);position:absolute;top:0;right:-50px;bottom:0;transition:opacity var(--list-bar-transition-duration) ease,right var(--list-bar-transition-duration) ease}.slomo.fullscreen .list-bar{transition:opacity calc(var(--list-bar-transition-duration) * 10) ease,right calc(var(--list-bar-transition-duration) * 10) ease}.notes.fullscreen .list-bar-open .list-bar{right:0;opacity:1}.notes.fullscreen .show-list .list-bar{visibility:visible}.notes.fullscreen .list-bar .header{height:var(--header-height);padding:0 0 0 calc(var(--app-padding) - 10px)}.notes.fullscreen .list-bar-toggle{height:var(--header-height);position:relative;top:0;right:-50px;bottom:calc(100% - var(--header-height));left:0;display:flex;justify-content:flex-end;align-items:stretch;transition:right .5s ease,border .5s ease}.notes.fullscreen .list-bar-open .list-bar-toggle{right:0}.notes.fullscreen .list-bar-toggle .icon-wrapper.toggle-list-icons{padding-left:10px;padding-right:23px}.notes.fullscreen .list-bar .header .icon-wrapper .icon-list-toggle{min-height:7px;min-width:11px}.notes.list-bar-toggle .icon-x{width:13px;display:none}.notes.list-bar-open .list-bar-toggle .icon-x{display:inline-block}.notes.fullscreen .notes-new,.notes.list-bar-open .list-bar-toggle .icon-list{display:none}.notes.fullscreen .notes-list-header .more-dropdown{top:36px}.notes.fullscreen .notes-list{width:auto;font-size:112.5%;border:none}.notes.fullscreen .subviews{height:100%}.notes.fullscreen .note-list-wrapper{height:100%;padding-top:0}.notes.fullscreen .note-list{padding-bottom:var(--app-padding);opacity:0;visibility:hidden}.notes.fullscreen .list-bar-open .note-list{opacity:1;visibility:visible}.notes.fullscreen .notes-list .list{max-height:calc(100% - var(--header-height));overflow-y:auto}.notes.fullscreen .notes-list-title{max-width:100%}.notes.fullscreen .notes-list-item{margin-top:0;padding-left:var(--app-padding);padding-right:var(--app-padding)}.notes.fullscreen .notes-list-item.selected{background-color:rgba(255,255,255,.1);box-shadow:none;z-index:0}.notes.fullscreen .list-borders.above-selected:after{bottom:-1px}.light .notes.fullscreen .notes-list-item.selected{background-color:rgba(0,0,0,.04)}.notes.fullscreen .notes-list-header .search-more-wrapper{opacity:0;visibility:hidden}.notes.fullscreen .list-bar-open .notes-list-header .search-more-wrapper{opacity:1;visibility:visible}.notes.fullscreen .detail-view{height:100%;width:100%;position:absolute;top:0;right:0;bottom:0;left:0}.notes.fullscreen .notes-detail-header{width:100%;padding:0!important;position:absolute;justify-content:space-between}.notes.fullscreen .notes-detail-header .toggle-list-icons{display:flex}.notes.fullscreen .list-bar-open .notes-detail-header .toggle-list-icons,.notes.fullscreen .notes-detail-title{display:none}.notes.fullscreen .toggle-list-icons .icon-list-toggle{height:10px;width:11px;min-width:11px;position:relative}.icon-list-toggle .list-toggle-bottom,.icon-list-toggle .list-toggle-middle,.icon-list-toggle .list-toggle-top{height:2px;width:11px;position:absolute;left:0;background:var(--icon-color);border-radius:2px;transition:transform .5s ease,opacity .5s ease}.icon-list-toggle .list-toggle-top{top:0}.icon-list-toggle .list-toggle-middle{top:4px}.icon-list-toggle .list-toggle-bottom{bottom:0}.list-bar-open .toggle-list-icons .icon-list-toggle{width:13px}.list-bar-open .icon-list-toggle .list-toggle-bottom,.list-bar-open .icon-list-toggle .list-toggle-middle,.list-bar-open .icon-list-toggle .list-toggle-top{width:13px;transform-origin:50% 50%}.list-bar-open .icon-list-toggle .list-toggle-top{transform:translate(-.7px,4.5px) rotate(-45deg)}.list-bar-open .icon-list-toggle .list-toggle-middle{opacity:0}.list-bar-open .icon-list-toggle .list-toggle-bottom{transform:translate(-1.3px,-3.5px) rotate(45deg)}.notes.fullscreen .icon-restore{display:inline-block}.notes.fullscreen .icon-expand{display:none}.notes.fullscreen .note-body{position:absolute;top:var(--header-height);right:0;bottom:0;left:0;transition:none}.notes .fullscreen-textarea .notes-textarea{padding:50px calc((100% - 750px)/ 2);font-size:19px;line-height:160%}.notes.fullscreen .notes-deleted-empty{width:calc(100vw - var(--sidebar-width))}@media handheld and (max-width:1130px),screen and (max-device-width:1130px),screen and (max-width:1130px){.notes .fullscreen-textarea .notes-textarea{transition:padding .5s ease}.notes.hide-content .fullscreen-textarea .notes-textarea{transition:none}.notes .fullscreen-textarea .list-bar-open .notes-textarea{padding:50px calc((var(--sidebar-width) - (100vw - 100%))/ 2 + 50px)}}@media handheld and (max-width:850px),screen and (max-device-width:850px),screen and (max-width:850px){.notes .fullscreen-textarea .notes-textarea{padding:50px}}',document.getElementsByTagName("head")[0].appendChild(t)},o.collect.Notes=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("notes"),baseUrl:l.globals.urlRootApi+"notes",notes_version:"1.0.3",initialize:function(){this.model=o.models.Note,this.listenTo(this,"change",this.onChange),this.listenTo(this,"reset",this.onReset),this.listenTo(this,"add",this.onAdd),window.addEventListener("storage",this.handleStorageEvent.bind(this),!1),this.fetchedFromServer=!1},handleStorageEvent:function(t){!this.removing_items&&t.key&&t.key.startsWith("notes")&&this.fetch({ignoreSave:!0})},activeNotes:function(){return _(this.where({deleted:!1})).chain().sortBy(function(t){return-t.get("updatedDate")}).value()},deletedNotes:function(){return _(this.where({deleted:!0})).chain().sortBy(function(t){return-t.get("updatedDate")}).value()},sortedNotes:function(){return _(this.models).chain().sortBy(function(t){return-t.get("updatedDate")}).value()},next:function(t){var e=this.activeNotes(),i=e.indexOf(t);return e[i==e.length-1?0:i+1]},prev:function(t){var e=this.activeNotes(),i=e.indexOf(t);return e[0==i?e.length-1:i-1]},onReset:function(){this.models.map(function(t){t.isDummy()&&t.delete()});var t=this,e=0<this.models.length;e&&this.hasAttribute("changed_props")?this.syncToServer(function(){t.fetchFromServer(function(){e||0<t.models.length&&t.trigger("active-model-changed")})}):t.fetchFromServer(function(){e||(0<t.models.length?t.trigger("active-model-changed"):t.trigger("update"))})},findHavingAttribute:function(e){return this.filter(function(t){return t.has(e)})},findNotHavingAttribute:function(e){return this.filter(function(t){return!t.has(e)})},findNewModels:function(){return this.filter(function(t){return!t.isDummy()})},hasAttribute:function(e){return!!this.find(function(t){return t.has(e)})},onAdd:function(t,e,i){i&&i.ignoreSave||this.syncToServer()},onChange:function(t,e){var i=this;if(!e.ignoreSave){var s=t.changedAttributes();if(s){var n=Object.keys(s).length;if(!s.updatedDate||!(1===n||2===n&&s.changed_props&&1===s.changed_props.length&&"updatedDate"===s.changed_props[0])){var o=null;for(prop in s)s.hasOwnProperty(prop)&&"changed_props"!==prop&&"_id"!==prop&&(o=o||(t.get("changed_props")||[]),_.contains(o,prop)||o.push(prop));o&&(t.save({updatedDate:l.date()},{silent:!0,ignoreSave:!0}),-1===o.indexOf("updatedDate")&&o.push("updatedDate"),t.save({changed_props:o,updatedDate:l.now()},{silent:!1,ignoreSave:!0,success:function(){setTimeout(function(){i.syncToServer()},50)}}))}}}},syncToServer:function(t){if(l.conditionalFeatures.featureEnabled("offlineDataOnly"))t&&t();else{var d=this,e=this.findHavingAttribute("changed_props");e&&0!=e.length||(e=this.findNewModels())&&0!=e.length?Promise.all(e.map(function(o){var l=!o.has("_id");if(!l){var a=o.get("changed_props");if(!a||0==a.length)return Promise.resolve()}var r={};return new Promise(function(t){if(l){var e=o.toJSON();e._cid=e.id,delete e.changed_props,delete e.id,e.notes_version=d.notes_version,c.ajax({url:d.baseUrl,contentType:"application/json",type:"POST",data:JSON.stringify(e)}).done(function(t){t&&t._id&&o.save({changed_props:null,_id:t._id},{silent:!0,ignoreSave:!0})}).fail(function(){}).always(t)}else{_.each(a,function(t){"changed_props"!=t&&(r[t]=o.get(t))});var i=Object.keys(r).length,s=r.hasOwnProperty("updatedDate");(1===i&&s||2===i&&s&&r.hasOwnProperty("id"))&&(o.save({changed_props:null},{silent:!0,ignoreSave:!0}),t());var n=d.baseUrl+"/"+encodeURIComponent(o.get("_id"));r.notes_version=d.notes_version,c.ajax({url:n,contentType:"application/json",type:"PATCH",data:JSON.stringify(r)}).done(function(){o.collection=d,o.save({changed_props:null},{silent:!0,ignoreSave:!0})}).fail(function(){}).always(t)}})})).then(function(){t&&t()}):t&&t()}},fetchFromServer:function(t){if(l.conditionalFeatures.featureEnabled("offlineDataOnly"))return this.fetchedFromServer=!0,this.trigger("fetchedFromServer"),void(t&&t());var s=this,n=0===this.models.length;c.ajax({url:this.baseUrl,contentType:"application/json",type:"GET",data:{loadDeleted:!0}}).done(function(t){if(t){var i=[];_.each(t,function(t){var e=s.findWhere({id:t.id});(e=e||s.findWhere({_id:t._id}))?(i.push(e.id),e.save(t,{silent:!0,ignoreSave:!0})):(i.push(t.id),s.create(t,{ignoreSave:!0}))});var e=[];s.each(function(t){t.has("id")&&!_.contains(i,t.get("id"))&&e.push(t.get("id"))}),0<e.length&&(s.removing_items=!0,_.each(e,function(t){var e=s.get(t);e&&e.destroy()}),s.removing_items=!1)}n&&s.trigger("refresh")}).fail(function(){}).always(function(){s.fetchedFromServer=!0,s.trigger("fetchedFromServer"),t&&t()})}}),o.models.Note=Backbone.Model.extend({url:l.globals.urlRootApi+"notes",defaults:function(){return{body:"",createdDate:l.date(),updatedDate:l.now(),deleted:!1}},constants:{titleLengthGuide:60,bodyPreviewMaxLength:150},delete:function(t){t=t||{},this.isDummy()?this.destroy(t):this.save({deleted:!0},t)},isDummy:function(){return 0===this.get("body").length&&!this.get("_id")},generateTitle:function(){var t,e,i,s=this.get("body");return s?(-1!=(i=(t=-1!=(e=s.indexOf("\n"))?s.slice(0,e):s).indexOf(" ",this.constants.titleLengthGuide-1))&&(t=t.slice(0,i)),t):"Empty Note"},checkForMultiLineNote:function(t){var e,i;return!!(e=-1!=(i=t.indexOf("\n"))?t.slice(i,t.length-1):null)&&-1!==e.search(/[^\s]+/)},getBodyPreview:function(){var t=this.get("body"),e=this.generateTitle();return this.delighter=this.delighter||this.getRandomDelighter(),t?this.checkForMultiLineNote(t)?t.substr(e.length,this.constants.bodyPreviewMaxLength).trim():" ":this.delighter},getRandomDelighter:function(){var t=["Type something cool!","Think of the possibilities...","Record some wisdom","Use your words","Type a tidbit","This is your canvas"];return t[Math.floor(Math.random()*t.length)]}}),o.views.Detail=Backbone.View.extend({className:"notes-detail",template:o.templates.detail,autoSaveDelay:500,usingMouse:!1,events:{"click .new":"new","click .restore-note":"handleClickRestore","click .restore":"handleClickRestore","click .delete":"toggleDeleteConf","click .delete-yes":"handleClickDelete","click .delete-no":"closeDeleteConf","click .delete-failed":"handleClickDelete","click .list-bar-toggle":"toggleListBar","blur .notes-textarea":"onBlur","focus .notes-textarea":"onFocus","keyup .notes-textarea":"handleKeyUp","keydown .notes-textarea":"handleKeyDown"},initialize:function(t){this.list=t.list,this.addListeners(),this.render(null,t.skipFocus),this.showDeleteConf=!1;var e=this;e.keyCount=0,window.onbeforeunload=function(){e.saveToModel()}},render:function(t,e){return this.$el.html(this.template({body:this.model.get("body"),isFullScreen:this.list.isFullScreen})),this.$noteTitle=this.$(".notes-detail-title"),this.$actionRightGroup=this.$(".main-nav"),this.$deleteGroup=this.$(".delete-nav"),this.$deleteYes=this.$(".delete-yes"),this.$textarea=this.$el.find(".notes-textarea"),this.$message=this.$el.find(".message"),this.setModel(this.model,this.scrollToBottom,e),this.plusExpired=l.conditionalFeatures.featureEnabled("notes-degraded"),this.$message.removeClass("active"),this},setModel:function(t,e,i){this.$message.removeClass("active");var s=this.model!==t;if(s&&(this.stopListening(),this.model=t,this.$(".notes-textarea").val(this.model?this.model.get("body"):""),this.$el.find(".detail-bar").toggleClass("inactive",!this.model),this.list.$el.toggleClass("deleted-empty",!this.model),this.showDeleteConf&&this.closeDeleteConf()),this.$el.toggleClass("deleted",this.model&&this.model.get("deleted")),this.updateTitle(),this.model){var n=this;this.addingListeners||(this.addingListeners=!0,setTimeout(function(){i||n.focusTextarea(),e&&n.scrollToBottom(),s&&n.addListeners(),n.addingListeners=!1},100))}},addListeners:function(){this.listenTo(l,"globalEvent:key:backspace globalEvent:esc",this.handleGlobalBack),this.listenTo(l,"globalEvent:metaBackspace",this.handleGlobalMetaBackspace),this.listenTo(l,"globalEvent:shiftN",this.handleGlobalCtrlN),this.listenTo(l,"globalEvent:metaBracketLeft",this.handleGlobalMetaBracketLeft),this.listenTo(l,"globalEvent:metaBracketRight",this.handleGlobalMetaBracketRight),this.listenTo(l,"globalEvent:altF",this.handleGlobalAltF),this.listenTo(l,"globalEvent:altL",this.handleGlobalAltL),this.listenTo(l.models.customization,"change:hour12clock",this.updateTitle),this.listenTo(this.model,"change:updatedDate",this.updateTitle),this.listenTo(this.model,"change:body",function(t,e,i){i&&i.selfUpdate||this.render()}),this.listenTo(this,"destroy",this.destroy)},updateTitle:function(){this.model?this.$noteTitle.text(this.formatDate(new Date(this.model.get("updatedDate")),l.models.customization.get("hour12clock"))):this.$noteTitle.text("")},destroy:function(){this.remove(),this.unbind(),this.$el.html("")},hideDetailBar:function(){this.detailBarHidden=!0,this.$(".detail-bar").mHide(!0)},showDetailBar:function(){this.$(".detail-bar").mShow(),this.detailBarHidden=!1},onBlur:function(){this.saveToModel()},onFocus:function(){this.$message.removeClass("active")},saveToModel:function(){var t=this.$textarea.val();this.model&&t!==this.model.get("body")&&!this.plusExpired&&this.model.set({body:t},{selfUpdate:!0})},focusTextarea:function(){var e=this;setTimeout(function(){e.$textarea.trigger("focus");var t=e.$textarea[0];t.selectionStart=t.selectionEnd=t.value.length},0)},handleKeyUp:function(t){if(t&&27===t.keyCode)return t.preventDefault(),t.stopPropagation(),void this.$textarea.trigger("blur");this.list.isFullScreen&&t&&13===t.keyCode&&this.$textarea.prop("selectionStart")===this.$textarea.val().length&&this.scrollToBottom();var e=this,i=++e.keyCount;setTimeout(function(){i===e.keyCount&&(e.saveToModel(),e.keyCount=0)},e.autoSaveDelay)},handleKeyDown:function(t){if(this.checkPlusExpired(t),this.model.get("deleted"))return this.$message.addClass("active"),t.preventDefault(),!1},checkPlusExpired:function(t){this.plusExpired&&(t&&t.preventDefault(),l.cmd("modal.open","UPSELL_NOTES",{sourceEvent:"Dash: expired plus"}))},scrollToBottom:function(){this.$textarea.scrollTop(this.$textarea[0].scrollHeight)},handleClickDelete:function(t){this.usingMouse=!0,t.stopPropagation(),this.delete()},handleClickRestore:function(t){this.usingMouse=!0,t.stopPropagation(),this.model.set("deleted",!1),this.list.switchToMain(this.model),this.$el.removeClass("deleted"),l.sendEvent("Notes","Restore")},back:function(t){this.list.isFullScreen?this.list.toggleFullscreen(null,t):(this.saveToModel(),this.list.handleBack(!1),this.model=null)},toggleListBar:function(){var t=this;this.list.isFullScreen&&(this.list.listBarOpen?(this.list.listBarOpen=!1,this.$el.removeClass("list-bar-open"),this.timeout=setTimeout(function(){t.$el.removeClass("show-list")},500)):(this.timeout&&clearTimeout(this.timeout),this.$(".list-bar").html()||(this.list.loadList(".list-bar"),this.list.addAll(!0)),this.list.listBarOpen=!0,this.list.selectItemById(this.model.id,!0),this.$el.addClass("show-list list-bar-open")),l.sendEvent("Notes","Toggle sidebar"))},new:function(){this.checkPlusExpired(),this.model.get("body")?(this.model=null,this.list.createNoteDetail()):this.focusTextarea()},toggleDeleteConf:function(){this.showDeleteConf=!this.showDeleteConf,this.$deleteGroup.toggleClass("show"),this.$deleteYes.removeClass("loading failed"),this.$actionRightGroup.mToggle("flex")},closeDeleteConf:function(t){t&&t.stopPropagation(),this.showDeleteConf=!1,this.$deleteGroup.removeClass("show"),this.$deleteYes.removeClass("loading failed"),this.$actionRightGroup.css("display","flex")},delete:function(){if(this.model){this.$deleteGroup.removeClass("failed"),this.model.delete(),this.model=null,l.sendEvent("Notes","Delete"),this.list.isFullScreen&&!this.list.collection.activeNotes().length?(this.list.destroyDetailView(),this.list.toggleFullscreen()):this.list.showNote()}},deleteViaHotkey:function(){this.toggleDeleteConf(),this.delete()},handleGlobalBack:function(t){if(this.list.isFullScreen)return t.preventDefault(),t.stopPropagation(),void this.back(!0);this.list.hideNotesPane()},handleGlobalMetaBackspace:function(t){this.list.open&&(t.preventDefault(),t.stopPropagation(),this.deleteViaHotkey())},handleGlobalShiftN:function(t){this.list.open&&(t.preventDefault(),t.stopPropagation(),this.list.createNoteDetail())},handleGlobalAltL:function(t){this.list.open&&(t.preventDefault(),this.list.isFullScreen&&this.toggleListBar())},handleGlobalAltF:function(t){this.list.open&&(t.preventDefault(),this.list.toggleFullscreen())},handleGlobalMetaBracketLeft:function(t){this.list.open&&(t.preventDefault(),t.stopPropagation(),this.saveToModel(),this.list.detailPrevNote(this.model))},handleGlobalMetaBracketRight:function(t){this.list.open&&(t.preventDefault(),t.stopPropagation(),this.saveToModel(),this.list.detailNextNote(this.model))},formatDate:function(t,e){var i,s=t.getHours(),n=l.utils.twoDigit(t.getMinutes());e?i=(s%12||12)+":"+n+" "+(12<=s?"PM":"AM"):i=l.utils.twoDigit(s)+":"+n;return l.utils.formatMonthDayRelative(t,!1)+l.utils.formatYearRelative(t)+" at "+i}}),o.views.Item=Backbone.View.extend({attributes:{class:"list-borders notes-list-item","data-test":"notes-list-item"},tagName:"li",template:o.templates.item,events:{click:"handleClick"},initialize:function(t){this.list=t.list,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:archive change:deleted remove",this.remove),this.listenTo(l.models.customization,"change:hour12clock",this.render)},render:function(){this.$placeholder=c("<li></li>").addClass("placeholder"),this.$placeholder.appendTo(this.el),this.$placeholder.hide();var t={title:this.model.generateTitle(),body:this.model.getBodyPreview(),updatedDate:this.formatDate(new Date(this.model.get("updatedDate")))};return this.$el.html(this.template(t)),this.$el.attr("data-note-id",this.model.id),this},destroy:function(){this.remove(),this.unbind()},handleClick:function(){this.list.handleItemClick(this.model)},formatDate:function(t){return l.utils.dateIsToday(t)?this.formatTime(t,l.models.customization.get("hour12clock")):l.utils.dateIsInLast7d(t)?l.utils.getDayName(t,!0):l.utils.getMonthName(t,!0)+" "+t.getDate()+l.utils.formatYearRelative(t)},formatTime:function(t,e){var i,s=t.getHours(),n=l.utils.twoDigit(t.getMinutes());e?i=(s%12||12)+":"+n+" "+(12<=s?"PM":"AM"):i=l.utils.twoDigit(s)+":"+n;return i}}),o.views.List=Backbone.View.extend({attributes:{id:"notes",class:"app notes-app","data-test":"notes-app"},template:o.templates.notes,open:!1,selectedNote:null,events:{"click .notes-empty-new":"createNoteFromEmptyState","keyup .notes-new":"handleInputKeyup","click .notes-new-error":"handleClickError","click .more-toggle":"toggleMore","click .back":"backToMain","click .back-to-list":"backToMain","click .show-deleted":"switchToDeleted","click .toggle-fullscreen":"toggleFullscreen","keyup .notes-search":"filterList","click .icon-clear-wrapper":"clearSearch","focus .notes-search":"onFocusSearch","blur .notes-search":"onBlurSearch"},initialize:function(){this.$el.attr(_.result(this,"attributes")),this.subViews=[],this.render();var t=this;this.listenTo(l,"globalEvent:key:backspace globalEvent:esc",this.handleGlobalBack),this.listenTo(l,"globalEvent:arrowUp",this.handleGlobalArrowUp),this.listenTo(l,"globalEvent:arrowDown",this.handleGlobalArrowDown),this.listenTo(l,"globalEvent:key:shiftN globalEvent:key:A",this.focusOnNewNote),this.listenTo(l,"globalEvent:click",this.handleClickOutside),this.listenTo(this.collection,"reset refresh",function(){t.addAll()}),this.listenTo(this.collection,"add",this.onCollectionAdd),this.listenTo(this.collection,"update",function(){t.handleUpdate()}),this.listenTo(this.collection,"change:updatedDate",this.handleChangeUpdatedDate),this.listenTo(this.collection,"fetchedFromServer",function(){t.handleUpdate()}),this.timeouts=[],this.collection.fetch({reset:!0}),this.isFullScreen=!1,this.listBarOpen=!1},handleChangeUpdatedDate:function(){this.addAll()},render:function(){this.$el.addClass("u--no-transition"),this.$el.html(this.template()),this.loadList(".list-view"),this.handleUpdate();var t=this;return this.renderedOnce||(setTimeout(function(){t.$el.removeClass("u--no-transition"),t.$el.find(".subviews").removeClass("u--no-transition")},20),this.renderedOnce=!0),this.plusExpired=l.conditionalFeatures.featureEnabled("notes-degraded"),this},onFocusSearch:function(){this.$(".search-wrapper").addClass("active")},onBlurSearch:function(){this.$(".search-wrapper").removeClass("active")},toggleMore:function(){var t=this.$(".more");t.toggleClass("active"),this.dropdownOpen=t.hasClass("active")},handleClickOutside:function(t){var e=this.$(".more");!this.dropdownOpen||c.contains(e[0],t.target)||c.contains(e.find(".dropdown")[0],t.target)||this.toggleMore()},triggerUpsell:function(){l.cmd("modal.open","UPSELL_NOTES",{sourceEvent:"Dash: expired plus"})},filterList:function(t){var e=this.$("#notes-search"),i=e.val().trim().toLowerCase();if(t&&27===t.keyCode)return t.preventDefault(),t.stopPropagation(),void(i?this.clearSearch():e.blur());this.$(".icon-clear").mToggle("initial",i),i&&this.$("#notes-search").addClass("search-active"),this.addAll(null,i)},clearSearch:function(){this.$("#notes-search").removeClass("search-active").val("").focus(),this.$(".icon-clear").hide(),this.addAll()},loadList:function(t){this.$el.find(t).html(o.templates.list()),this.$empty=this.$(".notes-empty"),this.$empty.mHide(),this.$noteList=this.$(".note-list"),this.$deletedList=this.$(".deleted-list"),this.$notesNewContainer=this.$(".notes-new-container"),this.$notesNew=this.$(".notes-new")},addAll:function(t,e){var i=this,s=void 0!==this.selectedNote&&c(this.$(".notes-list-item")[this.selectedNote]).attr("data-note-id");_.each(this.subViews,function(t){t&&t.destroy()});var n=!(this.subViews=[]);_.each(this.collection.sortedNotes(),function(t){e&&0<e.length&&t.get("body").toLowerCase().indexOf(e)<0||(i.addOne(t,!0),n=!0,s===t.id&&(i.selectedNote=i.$el.find('[data-note-id="'+t.id+'"]').index()))}),this.$(".notes-list").removeClass("loading"),this.handleUpdate(!0);var o,l=localStorage.getItem("current-note-id");if(e)return n&&(this.isFullScreen&&this.detailView.detailBarHidden&&this.detailView.showDetailBar(),this.selectedNote=0,(o=this.getSelectedNoteModel())&&!o.get("deleted"))?void this.handleItemClick(o,!0):void(this.isFullScreen?this.detailView.hideDetailBar():this.destroyDetailView());this.isFullScreen&&this.detailView.detailBarHidden&&this.detailView.showDetailBar(),l&&(o=this.collection.get(l));var a=this.collection.activeNotes();(!o||o.get("deleted")&&!this.inTrashView||o.isDummy())&&(o=a&&a[0]),!o||t||o.isDummy()||this.switchToDetailView(o)},addOne:function(t,e){var i=new o.views.Item({model:t,list:this}),s=i.render().el;this.subViews.push(i);var n=t.get("deleted")?this.$deletedList:this.$noteList;e?n.append(s):n.prepend(s)},onCollectionAdd:function(t){this.addOne(t,!1)},hideNotesPane:function(){var e=this;this.$el.closest(".notes").removeClass("show-fade-in"),setTimeout(function(){var t=e.$el.closest(".notes");t.hasClass("show-fade-in")||t.removeClass("show")},300)},handleGlobalBack:function(t){this.detailView?this.detailView.handleGlobalBack(t):this.hideNotesPane()},handleUpdate:function(t){var e=this.collection.activeNotes().length;0==e&&!this.inTrashView&&this.collection.fetchedFromServer?(this.$(".notes-list").removeClass("loading"),this.$empty.mShow(),this.$notesNew.mHide(),this.$noteList.mHide()):0!=e||this.collection.fetchedFromServer?(this.$(".notes-list").removeClass("loading"),this.$empty.mHide(),this.isFullScreen||this.$notesNew.mShow(),this.$noteList.mShow(),this.selectItemById(this.modelInFocus,t)):this.$(".notes-list").addClass("loading")},handleItemClick:function(t,e){t.isDummy()||this.switchToDetailView(t,!1,!1,e)},handleClickError:function(t){t.stopPropagation(),this.createNote()},backToMain:function(){this.switchToMain()},switchToDeleted:function(){this.deleteDummyNote(this.getSelectedNoteModel()),this.modelInFocus=null,this.toggleMore(),this.inTrashView=!0,this.$el.find(".subviews").addClass("second"),this.detailView&&this.detailView.setModel(null,!1,!0,!0),this.handleUpdate();var t=this.collection.deletedNotes();t&&0<t.length?(this.selectedNote=this.$el.find('[data-note-id="'+t[0].id+'"]').index(),this.switchToDetailView(t[0])):(this.$el.addClass("deleted-empty"),this.detailView&&this.detailView.setModel(null)),l.sendEvent("Notes","View deleted")},switchToMain:function(t){this.inTrashView=!1,this.$el.find(".subviews").removeClass("second"),this.handleUpdate(),this.detailView&&this.detailView.setModel(null),this.showNote(t),this.$el.removeClass("deleted-empty")},showNote:function(t){this.modelInFocus=null;var e=this.collection.activeNotes();e&&0<e.length?(t=t||e[0],this.selectedNote=this.$el.find('[data-note-id="'+t.id+'"]').index(),this.switchToDetailView(t)):this.isFullScreen?(this.switchToDetailView(t),this.createNoteFromEmptyState()):this.destroyDetailView()},deleteDummyNote:function(t){if(this.detailView&&this.detailView.model&&this.detailView.model.isDummy()&&(this.detailView.model.delete(),this.detailView.setModel(null),t.isDummy()))return!0},switchToDetailView:function(t,e,i,s){if(!this.deleteDummyNote(t)){t&&(this.selectItemById(t.id),this.modelInFocus!==t.id&&(this.modelInFocus=t.id,this.detailView?this.detailView.setModel(t,!1,s):(this.detailView=new o.views.Detail({model:t,list:this,skipFocus:s}),this.isFullScreen&&this.$el.find(".detail-view").html(this.detailView.render().el)),this.isFullScreen||e||(this.$el.find(".detail-view").html(this.detailView.render(!i,s).el),this.$el.find(".subviews")),this.selectItemById(t.id),localStorage.setItem("current-note-id",t.id)))}},destroyDetailView:function(){this.modelInFocus=null,this.detailView&&(this.detailView.destroy(),this.detailView=null)},handleInputKeyup:function(t){13==t.keyCode?(t.stopPropagation(),this.plusExpired?this.triggerUpsell():this.createNote()):38==t.keyCode?(this.$notesNew.trigger("blur"),this.selectPrevItem()):40==t.keyCode&&(this.$notesNew.trigger("blur"),this.selectNextItem())},isOpen:function(){return this.$el.closest(".notes").hasClass("show")},handleGlobalArrowUp:function(t){this.isOpen()&&(t.preventDefault(),t.stopPropagation(),this.selectPrevItem())},handleGlobalArrowDown:function(t){this.isOpen()&&(t.preventDefault(),t.stopPropagation(),this.selectNextItem())},focusOnNewNote:function(t){this.isOpen()&&(t.preventDefault(),t.stopPropagation(),this.focusNewNoteViaHotkey())},selectPrevItem:function(){if(0!=this.collection.activeNotes().length){var t=(this.inTrashView?this.$(".trash-subview"):this.$(".note-list-wrapper")).find(".notes-list-item");null==this.selectedNote?this.selectedNote=t.length-1:(c(t[this.selectedNote]).removeClass("selected").prev().removeClass("above-selected"),this.selectedNote=0==this.selectedNote?t.length-1:this.selectedNote-1),c(t[this.selectedNote]).addClass("selected"),this.scrollItemIntoView(c(t[this.selectedNote]));var e=this.getSelectedNoteModel();e&&this.handleItemClick(e,!0)}},selectNextItem:function(){if(0!=this.collection.activeNotes().length){var t=(this.inTrashView?this.$(".trash-subview"):this.$(".note-list-wrapper")).find(".notes-list-item");null==this.selectedNote?this.selectedNote=0:(c(t[this.selectedNote]).removeClass("selected").prev().removeClass("above-selected"),this.selectedNote=this.selectedNote==t.length-1?0:this.selectedNote+1),c(t[this.selectedNote]).addClass("selected").prev().addClass("above-selected"),this.scrollItemIntoView(c(t[this.selectedNote]));var e=this.getSelectedNoteModel();e&&this.handleItemClick(e,!0)}},tearDown:function(){this.isFullScreen&&this.toggleFullscreen(),this.dropdownOpen&&this.toggleMore()},selectItemById:function(t,e){this.$el.find(".notes-list-item.selected").removeClass("selected").prev().removeClass("above-selected");var i=this.$el.find('[data-note-id="'+t+'"]');i.prev().addClass("above-selected"),this.selectedNote=i.addClass("selected").index();var s=this;s.inTrashView&&this.listBarOpen&&(e&&s.$(".subviews").addClass("u--no-transition"),s.$(".subviews").addClass("second")),setTimeout(function(){s.$(".subviews").removeClass("u--no-transition")},200)},clearSelectedNote:function(){this.$el.find(".notes-list-item.selected").removeClass("selected").prev().removeClass("above-selected"),this.selectedNote=null},getSelectedNoteModel:function(){var t=c(this.$(".notes-list-item")[this.selectedNote]).data("note-id");return this.collection.get(t)},createNote:function(){var e=this;if(!this.$notesNewContainer.hasClass("loading")){var t=this.$notesNew[0].value.trim();t&&(t+="\n",this.$notesNewContainer.removeClass("failed").addClass("loading"),e.collection.create({body:t},{wait:!0,success:function(t){e.$notesNewContainer.removeClass("loading"),e.switchToDetailView(t),e.$notesNew[0].value="",e.instrumentCreateNote()},error:function(){e.$notesNewContainer.removeClass("loading").addClass("failed")}}))}},createNoteFromEmptyState:function(){if(this.plusExpired)this.triggerUpsell();else{var e=this;this.model=null,e.collection.create({body:""},{wait:!0,success:function(t){e.switchToDetailView(t),e.instrumentCreateNote()},error:function(){console.log("error creating note")}})}},createNoteDetail:function(){var e=this;this.model=null,e.collection.create({body:""},{wait:!0,success:function(t){e.switchToDetailView(t,!0),e.instrumentCreateNote()},error:function(){console.log("error creating note")}})},instrumentCreateNote:function(){l.sendEvent("Notes","Create")},detailNextNote:function(t){this.switchToDetailView(this.collection.next(t))},detailPrevNote:function(t){this.switchToDetailView(this.collection.prev(t))},focusNewNote:function(){null==this.selectedNote&&this.$notesNew.trigger("focus")},focusNewNoteViaHotkey:function(){null!=this.selectedNote&&this.clearSelectedNote(),this.$notesNew.trigger("focus")},scrollItemIntoView:function(t){var e=t[0],i=t.parent()[0];if(e){var s=e.getBoundingClientRect().bottom-i.getBoundingClientRect().bottom;0<s&&(i.scrollTop+=s);var n=e.getBoundingClientRect().top-i.getBoundingClientRect().top;n<0&&(i.scrollTop+=n)}},preventCloseOnEsc:function(){return this.isFullScreen},toggleFullscreen:function(t,e){var i=this;if(0,this.timeouts.length&&this.timeouts.forEach(function(t){clearTimeout(t)}),e||this.detailView&&this.detailView.focusTextarea(),this.isFullScreen)this.isFullScreen=!1,this.$el.closest(".app-container").addClass("hide-content"),this.timeouts.push(setTimeout(function(){i.$(".subviews").addClass("u--no-transition"),i.$el.css({position:"fixed",top:window.innerHeight-i.rect.top,right:i.rect.right,bottom:i.rect.bottom,left:window.innerWidth-i.rect.left}),l.widgetManager.showApps(),i.$(".list-bar").html(""),i.loadList(".list-view")},100)),this.timeouts.push(setTimeout(function(){i.$el.removeClass("fullscreen-textarea"),i.$el.closest(".app-container").removeClass("fullscreen hide-content"),i.$el.css({transition:"",position:"",top:"",right:"",bottom:"",left:""}),i.inTrashView&&i.$(".subviews").addClass("u--no-transition second"),i.$el.closest(".app-wrapper").addClass("nipple nipple-bottom-right"),i.addAll()},300)),this.timeouts.push(setTimeout(function(){i.$(".subviews").removeClass("u--no-transition")},350));else{var s=this.$el[0].getBoundingClientRect();this.rect={top:s.top,right:window.innerWidth-s.right,bottom:window.innerHeight-s.bottom,left:s.left},this.$el.closest(".app-container").addClass("hide-content"),this.$el.css({position:"fixed",top:this.rect.top,right:this.rect.right,bottom:this.rect.bottom,left:this.rect.left}),this.rect.top=window.innerHeight-this.rect.top,this.rect.left=window.innerWidth-this.rect.left,this.timeouts.push(setTimeout(function(){i.$el.closest(".app-container").addClass("fullscreen"),l.widgetManager.hideAppsExcept(".apps .notes"),i.$(".list-view").html(""),i.isFullScreen=!0,i.$(".list-bar").html()||(i.loadList(".list-bar"),i.addAll()),i.$el.css({transition:"all 200ms ease",top:0,right:0,bottom:0,left:0}),i.$el.closest(".app-wrapper").removeClass("nipple nipple-bottom-right"),i.$el.addClass("fullscreen-textarea")},100)),this.timeouts.push(setTimeout(function(){i.$el.closest(".app-container").removeClass("hide-content")},300))}l.sendEvent("Notes","Toggle fullscreen")}}),l.collect.notes=new o.collect.Notes,o.styles.style(),l.views.notes=l.widgetManager.handover("notes",o.views.List,{collection:l.collect.notes,region:"bottom-right",order:"prepend"}),l.widgets.push(l.views.notes),o};m.addinManager&&m.addinManager.registerAddinFn("23c67761-9831-415e-b358-c6844eb6c244",fn_addin);