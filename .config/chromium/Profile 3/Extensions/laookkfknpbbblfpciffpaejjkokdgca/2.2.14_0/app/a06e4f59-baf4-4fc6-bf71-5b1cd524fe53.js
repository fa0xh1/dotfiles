var fn_addin=function(r,s,e){var t=t||{};t.styles=t.styles||{},t.commands=t.commands||{},t.dependencies=e||t.dependencies||{},t.styles.style=function(){},t.views=t.views||{},t.collect=t.collect||{},t.models=t.models||{},t.templates=t.templates||{},t.info={widget:!0,placeholderType:"none",id:"multi_clock_detail",addin:"a06e4f59-baf4-4fc6-bf71-5b1cd524fe53",dependencies:["multiclock"]},r.console.log(r.elapsed()+": "+t.info.id+" started"),t.templates=t.templates||{},t.templates.editClock=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,i,s){return'<div class="input-group current-timezone-group">\n\t<label for="current-timezone">Location</label>\n\t<div class="input-wrapper">\n\t\t<input type="text" name="current-timezone" id="current-timezone" class="current-timezone" placeholder="" spellcheck="false" data-test="multiclock-search" autocomplete="off">\n\t\t<i class="u--flex-center clear" data-test="clear"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212.982 212.982" class="icon icon-hide"><path d="M131.804 106.491l75.936-75.936c6.99-6.99 6.99-18.323 0-25.312-6.99-6.99-18.322-6.99-25.312 0L106.491 81.18 30.554 5.242c-6.99-6.99-18.322-6.99-25.312 0-6.989 6.99-6.989 18.323 0 25.312l75.937 75.936-75.937 75.937c-6.989 6.99-6.989 18.323 0 25.312 6.99 6.99 18.322 6.99 25.312 0l75.937-75.937 75.937 75.937c6.989 6.99 18.322 6.99 25.312 0 6.99-6.99 6.99-18.322 0-25.312l-75.936-75.936z"/></svg></i>\n\t</div>\n\t<div class="typeahead dropdown">\n\t\t<div class="typeahead-content">\n\t\t\t<div class="searching">Searching<i>.</i><i>.</i><i>.</i></div>\n\t\t\t<ul class="dropdown-list" data-test="multiclock-results"></ul>\n\t\t\t<div class="not-found">No locations found.</div>\n\t\t</div>\n\t</div>\n</div>\n\n\n<div class="input-group clock-name-group">\n\t<label for="clock-name">Name</label>\n\t<div class="input-wrapper">\n\t\t<input type="text" name="clock-name" id="clock-name" class="clock-name" placeholder="" spellcheck="false" data-test="multiclock-name" autocomplete="off">\n\t</div>\n</div>\n\n<div class="input-group create-pinned-group has-toggle" data-test="pin">\n\t<label for="create-pinned">Pinned</label>\n\t<span class="toggle-slider"><svg class="toggle-switch" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg></span>\n</div>\n\n<div class="metric-edit-controls">\n\t<span class="error-message"><span class="save-error"></span></span>\n\t<span class="button save" data-test="multiclock-save">Save</span>\n</div>\n'},useData:!0}),t.styles=t.styles||{},t.styles.style=function(){var e=document.createElement("style");e.type="text/css",e.innerHTML=".multiclock .input-group,.multiclock .metric-edit-controls{margin-right:calc((var(--metric-width) - (100% + var(--app-padding) * 2)) * -1);flex:1 0 auto}.multiclock .input-wrapper{font-size:1.125rem}.multiclock .metric-detail .body{display:flex;flex-direction:column}.multiclock .current-timezone-group{min-height:0;position:relative;display:flex;flex-direction:column;flex:0 1 60%}.multiclock .current-timezone-group .input-wrapper{position:relative}.multiclock .current-timezone{padding-right:18px}.multiclock .typeahead{min-height:0;transition:height .3s ease;flex:1 1 auto;overflow-y:auto}.multiclock .typeahead .dropdown-list{display:none}.multiclock .typeahead .dropdown-list li{margin-right:calc((var(--metric-width) - (var(--app-padding) * 2) - 100%) * -1);padding-right:13px;display:block}.multiclock .search-loading .typeahead .dropdown-list{padding:0}.multiclock .clear{padding:0 5px;position:absolute;top:-4px;right:-5px;bottom:0;opacity:0;cursor:text;font-size:.8125rem}.multiclock .has-input .clear{opacity:.4;cursor:pointer}.multiclock .has-input .clear:hover{opacity:.8}.multiclock .has-input .clear:active{opacity:1}.multiclock .typeahead .location{margin-right:2px}.multiclock .typeahead .timezone{opacity:.5;font-size:.6875rem;word-break:keep-all}.multiclock .metric-detail .save{margin-top:0}.multiclock .searching{padding:4px 7px;display:none;font-size:87.5%;opacity:.6}.multiclock .search-loading .searching{display:block}.multiclock .search-loading .typeahead{padding:4px 0}.multiclock .search-loading .not-found{display:none}.multiclock .searching i{animation:blink 1.4s infinite both}.multiclock .searching i:nth-child(2){animation-delay:.2s}.multiclock .searching i:nth-child(3){animation-delay:.4s}@keyframes blink{0%,100%{opacity:.2}20%{opacity:1}}",document.getElementsByTagName("head")[0].appendChild(e)},t.views.MultiClock=Backbone.View.extend({events:{"keyup .clock-name":"updateSaveButtonState","click .save":"saveClock","change .clock-timezone":"updateClock","blur .clock-name":"updateSaveButtonState","click .current-timezone-group .clear":"clearLocation","click .dropdown-list li":"chooseLocation","click .current-timezone":"showDropdown","keyup .current-timezone":"checkSearch","keydown .current-timezone":"preventDefaultAction","mouseover .dropdown-list li":"updateHover","click .create-pinned-group":"togglePinned"},initialize:function(e){this.collection=e.collection,this.parentView=e.parentView,this.template=t.templates.editClock,this.loadingSearch=0},render:function(e){return this.variables=e,this.$el.html(this.template(e)),this.collectElements(),this.initializeResizeSensor(),this},initializeResizeSensor:function(){this.resizeSensor&&this.resizeSensor.detach(),this.resizeSensor=new ResizeSensor(this.$typeAheadContent,function(){this.$typeAhead.css("height",this.$typeAheadContent[0].clientHeight)}.bind(this))},showDropdown:function(){this.$dropdownList.find("li").length?this.$dropdownList.css("display","block"):this.searchForLocation()},collectElements:function(){this.$name=this.$(".clock-name"),this.$currentTimezone=this.$(".current-timezone"),this.$save=this.$(".save"),this.$currentTimezoneGroup=this.$(".current-timezone-group"),this.$typeAheadContent=this.$(".typeahead-content"),this.$typeAhead=this.$(".typeahead"),this.$notFound=this.$(".typeahead .not-found"),this.$dropdownList=this.$(".dropdown-list"),this.$pinned=this.$(".create-pinned-group")},onChange:function(){this.editDetail()},preventDefaultAction:function(e){38!==e.keyCode&&40!==e.keyCode||e.preventDefault()},checkSearch:function(e){var t=this;if(this.model||this.$save.addClass("disabled"),e.keyCode===r.utils.mConst("keyEscape"))this.revertLocation();else{if(37===e.keyCode||39===e.keyCode)return;if(9===e.keyCode&&e.shiftKey||16===e.keyCode)return void this.showDropdown();if(e.keyCode===r.utils.mConst("keyReturn")){if(!this.suggestionList||0===this.suggestionList.length)return;this.chooseLocation()}else if(38===e.keyCode){if(!this.suggestionList||0===this.suggestionList.length)return;this.selected=0===this.selected?this.suggestionList.length-1:this.selected-1,this.hoverSelected()}else if(40===e.keyCode){if(!this.suggestionList||0===this.suggestionList.length)return;this.selected=this.selected===this.suggestionList.length-1?0:this.selected+1,this.hoverSelected()}else{var i=this.$currentTimezone.val().trim().length;this.renderClearIcon();var s=r.date().getTime();this.triggeredSearchAt=s,2<i&&setTimeout(function(){s===t.triggeredSearchAt&&t.searchForLocation(),t.triggeredOnce=!0},t.triggeredOnce?300:0),i<3&&(this.$dropdownList.empty(),0===this.$dropdownList.val().trim.length&&this.closeDropdown())}}},closeDropdown:function(){this.$dropdownList.hide(),this.$notFound.removeClass("active"),this.typeaheadVisible=!1,this.noResults=!1,this.$currentTimezoneGroup.css("min-height","")},revertName:function(){this.$name.val(this.model?this.model.get("name"):""),this.$name.trigger("blur")},handleResize:function(){this.typeaheadVisible&&this.$currentTimezoneGroup.css("min-height",this.getCurrentTimezoneGroupMinHeight())},revertLocation:function(){this.suggestionList=null,this.$currentTimezone.val(this.model?this.model.get("timeZoneName"):""),this.$currentTimezone.trigger("blur"),this.closeDropdown()},getCurrentTimezoneGroupMinHeight:function(){var e="label[for=current-timezone], .input-wrapper, "+(this.noResults?".not-found":".dropdown-list > li:first-child, .dropdown-list > li:nth-child(2)"),t=0;return this.$currentTimezoneGroup.find(e).each(function(){t+=this.clientHeight}),t+8},searchForLocation:function(){this.$currentTimezoneGroup.css("min-height","");var i=this,e=this.$currentTimezone.val();if(0!==e.trim().length&&this.lastQuery!==e){this.lastQuery=e,this.noResults=!1;var t=r.globals.urlRootApi+"timezones/search";this.loadingSearch++,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){i.$typeAhead.css("display","block"),i.$el.addClass("search-loading")},300),s.ajax({type:"GET",contentType:"application/json",url:t,data:{name:e.toLowerCase()}}).done(function(e){if(i.loadingSearch--,i.$notFound.removeClass("active"),e&&0===i.loadingSearch){i.suggestionList=e,i.$dropdownList.empty(),i.suggestionMap={};var t=0;if(this.typeaheadVisible=!0,0===i.suggestionList.length)return 0===i.loadingSearch&&i.$notFound.addClass("active"),i.noResults=!0,i.$dropdownList.hide(),i.$save.addClass("disabled"),i.timeout&&clearTimeout(i.timeout),i.$el.removeClass("search-loading"),void i.$currentTimezoneGroup.css("min-height",i.getCurrentTimezoneGroupMinHeight());i.suggestionList.forEach(function(e){i.suggestionMap[e.name]=e,i.$dropdownList.append('<li data-id="'+e.displayName+'" data-index='+t+" data-offset="+e.currentOffset+'><span class="location">'+e.name+'</span> <span class="timezone">'+e.offsetString+"</span></li>"),t++}),i.$dropdownList.css("display","block"),i.selected=0,i.hoverSelected(),i.$typeAhead.css("display","block"),i.timeout&&clearTimeout(i.timeout),i.$el.removeClass("search-loading"),i.$currentTimezoneGroup.css("min-height",i.getCurrentTimezoneGroupMinHeight())}}).fail(function(){i.loadingSearch--,i.timeout&&clearTimeout(i.timeout),i.$el.removeClass("search-loading")})}},hoverSelected:function(){this.hoverById(this.suggestionList[this.selected].displayName)},hoverById:function(e){this.$dropdownList.find("li").removeClass("hover"),this.$dropdownList.find('li[data-id="'+e+'"]').addClass("hover")},chooseLocation:function(){this.$save.removeClass("disabled"),this.selectedTimezone=this.suggestionList[this.selected],this.$name.val(this.selectedTimezone.shortName),this.$currentTimezone.val(this.selectedTimezone.name),this.$name.trigger("focus"),this.updateClock()},updateHover:function(e){var t=e.delegatedTarget.dataset,i=t.id;this.selected=Number.parseInt(t.index),this.hoverById(i)},clearLocation:function(){this.$typeAhead.hide(),this.$currentTimezone.val("").trigger("focus"),this.typeaheadVisible=!1,this.noResults=!1,this.$currentTimezoneGroup.css("min-height",""),this.renderClearIcon()},onTimezoneReset:function(){this.variables&&this.render(this.variables)},isFormValid:function(){var e=0===this.$name.val().trim().length;return 0<this.$currentTimezone.val().length&&!e&&(this.selectedTimezone||this.model)},updateSaveButtonState:function(e){this.saveDisabled=!this.isFormValid(e),this.$save.toggleClass("disabled",this.saveDisabled),e&&e.keyCode===r.utils.mConst("keyEscape")?this.revertName():!this.saveDisabled&&e&&e.keyCode===r.utils.mConst("keyReturn")&&this.update(!0,!0)},updateNameOnBlur:function(){if(!(0===this.$name.val().trim().length)&&this.model){if(this.model.get("name")===this.$name.val())return;this.update(!0)}},startAdding:function(){var e=this;this.resetView(),this.$(".save").text("Create"),setTimeout(function(){e.$currentTimezone.trigger("focus")},250)},update:function(e,t){this.$el.find(".error-message").hide(),this.closeDropdown(),(this.model||t)&&this.save(this.model,e)},updateClock:function(){this.update()},saveClock:function(){var e;this.$save.hasClass("disabled")||(this.model?(e=this.model,this.save(e,!0)):e=this.save(),e&&(this.model.set("selected",!0),this.parentView.highlightSelectedMetric()))},save:function(e,t){var i=0===this.$name.val().trim().length;if(0==this.$currentTimezone.val().trim().length)this.$currentTimezone.trigger("focus");else{if(!i){var s,n,o=r.utils.removeTags(r.utils.capitalizeWords(this.$name.val().trim())),a=this.$pinned.hasClass("on");this.selectedTimezone?(s=this.selectedTimezone.id,timezoneName=this.selectedTimezone.name,n=this.selectedTimezone.currentOffset):e&&(s=e.get("timeZoneId"),timezoneName=e.get("timeZoneName"),n=e.get("currentOffset"));var l={name:o,timeZoneName:timezoneName,currentOffset:n,timeZoneId:s,pinned:a};return e?(e.set(l,{ignoreRender:!0}),t&&(this.parentView.switchToListView(),this.$name.val(""),this.$name.trigger("blur"))):(this.model=this.parentView.createMetric(l),this.$name.val(""),this.$name.trigger("blur")),e||this.model}this.$name.trigger("focus")}},editDetail:function(e){this.resetView(),this.model=e,this.$name.val(e.get("name")),this.$currentTimezone.val(e.get("timeZoneName")),this.$pinned.toggleClass("on",e.get("pinned")),this.renderClearIcon(),this.$el.find(".error-message").hide(),this.updateSaveButtonState();var t=this;setTimeout(function(){t.$name.trigger("focus")},250)},renderClearIcon:function(){0<this.$currentTimezone.val().trim().length?this.$currentTimezoneGroup.addClass("has-input"):this.$currentTimezoneGroup.removeClass("has-input")},resetView:function(){this.model=null,this.render({placeholder:"multiclock",createMode:!0}),this.$name.val(""),this.$el.find(".error-message").hide(),this.$save.addClass("disabled"),this.saveDisabled=!0,this.selectedTimezone=null,this.$notFound.removeClass("active")},togglePinned:function(e){this.$pinned.toggleClass("on"),this.updateSaveButtonState(e)}});var i=t.dependencies.multiclock;return t.styles.style(),i.views.multiClock.setDetailViewClass(t.views.MultiClock),t};m.addinManager&&m.addinManager.registerAddinFn("a06e4f59-baf4-4fc6-bf71-5b1cd524fe53",fn_addin);